---
layout: post
title: Изменение CDO блюпринта другим блюпринтом
published: false
---
# Введение
Иногда возникает ситуация, когда база блюпринтов одного типа разрастается до десятков и сотен, например в игре большое количество оружия и амуниции, или заклинаний и зелий.
Для геймдизайнера это страшный ад, даже если все блюпринты хорошо рассортированы по папкам, искать нужный среди них, потом искать нужную переменную и вручную менять каждую из них крайне утомительное занятие.
К счастью мы можем немного облегчить его страдания.
Главный вопрос в том, как поменять значение переменной блюпринта не собственными руками, а например, другим блюпринтом.  
Именно это я опишу в этом посте.  

# CDO (Class Default Object)
CDO или Class Default Object - это шаблон конкретного класса, который движок будет использовать в качество прототипа для создания объектов этого класса, по сути это полная копия этого класса.  
CDO создается совершенно для любого блюпринта и С++ класса, помеченного макросом UCLASS(). В большей степени он необходим Reflection (Unreal Property System) системе движка.
Я не буду углубляться в эти системы, так как для данного поста достаточно информации выше. В конце статьи я приведу ссылки на полезные материалы по этим темам.  

Вернемся к главному вопросу: "Как поменять переменную блюпринта другим блюпринтом?", сейчас нам очень пригождаются знания о существовании CDO. 
Можно ли сказать, что когда мы меняем значение переменной блюпринта, мы меняем его CDO? Да, конечно, ведь по сути именно это мы и делаем. 
Внезапно наш вопрос меняется: "Как изменить CDO блюпринта другим блюпринтом?". К сожалению, в блюпринтах есть возможность только лишь получить CDO с помощью функции "Get Class Defaults",
но не изменить его. Досадно...  
Однако сделать это в коде, очень просто.  

Нам нужно создать BlueprintFunctionLibrary, в которую мы добавим функцию, которая будет возвращать CDO блюпрнта.  
MyBlueprintFunctionLibrary.h:
#pragma once

#include "CoreMinimal.h"
#include "Kismet/BlueprintFunctionLibrary.h"
#include "MyBlueprintFunctionLibrary.generated.h"

UCLASS()
class THIRDPERSONPROJ_API UMyBlueprintFunctionLibrary : public UBlueprintFunctionLibrary
{
	GENERATED_BODY()

    UFUNCTION(BlueprintCallable, Category = "MyBlueprintFunctionLibrary")
    static UObject* GetCDO(UClass* Class)
  {
    return Class->GetDefaultObject();
  }
	
};

GetDefaultObject() как раз та самая C++ функция, которая возвращает CDO блюпринта и позволяет нам с ним делать все, что мы хотим.  

Теперь представим, что у меня в проекте есть два предмета для восстановления здоровья, и у них будет переменная HealCount, которая означает количество восстанавливаемого здоровья при подборе.
Далее главной целью этого поста будет сделать инструмент внутри движка, который позволит мне увеличивать значение этой переменной одновременно у обоих предметов на одинаковую величену нажатием одной кнопки.

Теперь возвращаемся к движку. Дальнейшую логику буду писать в EditorUtilityWidget, поэтому создаем новый блюпринт этого класса.  
![]({{site.baseurl}}/images/2023-01-20-change-CDO-by-blueprint/2023-01-20-change-CDO-by-blueprint.1.png)  
О том что это такое есть отдельная статья: https://pelogetan.github.io/blutilities-and-editorutilitywidget/  

Теперь добавляем кнопку и поле для ввода текста:  
![]({{site.baseurl}}/images/2023-01-20-change-CDO-by-blueprint/2023-01-20-change-CDO-by-blueprint.2.png)  

Переходим в Event Graph, добавляем ивент нажатия на кнопку и пишем логику:  
В первую очередь, нам нужно каким-то образом получить класс наших блюпринтов. Есть два пути:  
1 - Создать массив классов и добавить туда нужные нам классы блюпринтов.  
2 - Создать массив строк и добавить туда текстовые ссылки на классы.  
Чтобы получить ссылку на класс, нужно нажать ПКМ на блюпринт и выбрать "Copy Reference". Второй способ так же потребует исопользования функции LoadBlueprintClass, чтобы получить класс по ссылке.  
Второй способ очень полезен, если вы храните и настраиваете все значения блюпринтов вне движка, а загружаете их в него.  
Далее буду рассматривать первый способ.  

Итак, у
