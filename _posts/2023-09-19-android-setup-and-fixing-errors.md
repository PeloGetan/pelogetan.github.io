---
layout: post
title: Unreal Engine 4.27 настройка Android билда
published: false
---
### Введение
К сожалению [официальный гайд](https://docs.unrealengine.com/4.27/en-US/SharingAndReleasing/Mobile/Android/Setup/) по настройке Android билда на UE4.27 устарел и если сейчас полностью следовать ему, то вы гарантированно получите ошибку "Тут ошибки и скрин". Я промучился день, пытаясь исправить эту и многие последующие ошибки. Поэтому написал этот гайд, в котором подробно объясню, что и куда надо нажимать, чтобы ничего не сломать.

### Если вы уже устанавливали Android Studio и пытались в нем что-то менять
Анрил очень прихотливый в плане настройки SDK и NDK, чуть шаг влево, шаг вправо, получите сто ошибок во время компиляции. Поэтому первым делом, если вы уже пользовались официальным или, не дай бог, неофициальным гайдом от индуса с ютуба, сносим все до основания. **Это важно!**
1. Удаляем Android Studio с пк через панель управления.
2. Удаляем папки:
  C:\Program Files\Android
  C:\Users\user\.android
  C:\Users\user\.gradle
  C:\Users\user\AppData\Local\Android
  C:\[Ваш проект на UE4]\Build\Android
  C:\[Ваш проект на UE4]\Build\Android_MultiClient
  C:\[Ваш проект на UE4]\Intermediate\Android
  C:\[Ваш проект на UE4]\DerivedDataCache
3. Открываем "Переменные среды" и удаляем:
  ANDROID_HOME
  JAVA_HOME
  NDK_ROOT
  NDRROOT
4. Перезапускаем ПК.
Ура, мы избавились от мусора, который остался от предыдущих попыток.

### Установка Android Studio 4 и настройка
В официальном гайде Эпики просят устанавливать Android Studio 4, так и делаем, скачать его можно [с официального сайта](https://developer.android.com/studio/archive), **нужен Android Studio 4.0 May 28, 2020**. 
1. Устанавливаем, при запуске везде жмем да, кроме выбора, там кастом ( тут более подробно с картинками ).
2. Запускаем и открываем SDK.
3. Выбираем Android SDK Commandline Tool 8.0, устанавливаем и закрываем программу.
4. Теперь нам нужно перейти в папку с движком, в моем случае это **C:\UE4.27\UnrealEngine\Engine\Extras\Android** если у вас не сорс билд, ничего страшного, там есть точно такая же папка. Тут нам нужен один из файлов **SetupAndroid**, выберете его в зависимости от вашей ОС (SetupAndroid.bat is for Windows, SetupAndroid.command is for Mac, and SetupAndroid.sh is for Linux). 
5. Далее одно из действий в зависимости от файла:
- **SetupAndroid.bat**, меняем все строки **SDKMANAGER=** на **SDKMANAGER=%STUDIO_SDK_PATH%\cmdline-tools\8.0\bin\sdkmanager.bat**
- **SetupAndroid.command** или **SetupAndroid.sh**, меняем все строки **SDKMANAGERPATH=** на **SDKMANAGERPATH="$STUDIO_SDK_PATH/cmdline-tools/8.0/bin"**
По сути такие строки там всего две и они рядом.
6. Запускаем измененный файл и ждем, когда прогресс завершится успешно.
7. Перезапускаем ПК.
Ура, можно радоваться, если все вышеперечисленное было сделано по инструкции, то сейчас все должно работать. Запускаем движок и билдим под андройд. Сначала будет долгая компиляция, но это только в первый раз, дальше будет быстрее.

### Если вдруг возникла возникла ошибка
Может быть такое что в какой-то момент во время билда появится какая-нибудь ошибка и чтение лога не дает нормального понимания в чем дело, то нужно снова выполнить этот шаг:
Удаляем папки:
  C:\Program Files\Android
  C:\Users\user\.android
  C:\Users\user\.gradle
  C:\Users\user\AppData\Local\Android
  C:\[Ваш проект на UE4]\Build\Android
  C:\[Ваш проект на UE4]\Build\Android_MultiClient
  C:\[Ваш проект на UE4]\Intermediate\Android
  C:\[Ваш проект на UE4]\DerivedDataCache
Запускаем анрил и билдим. Снова будет долгая компиляция, но ошибка должна пропасть.

### Заключение
Я очень надеюсь, что этот пост поможет кому-то избежать потери времени и нервов и так же хочу отметить, что **я не эксперт в андройде**, поэтому я могу что-то не знать и где-то ошибаться. Методом проб и ошибок мне удалось добился стабильной работы UE4.27 с андройдом и не могу не поделиться этой информацией, так как сам не нашел этой информации нигде.